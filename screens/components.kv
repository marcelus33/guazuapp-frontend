# BoxLayout con Toolbar que se usa de base en todas las pantallas
<BaseLayout@MDBoxLayout>:
    id: main_toolbar
    title: self.title if self.title else 'GuazuApp'
    orientation: 'vertical'
    last_right_icon: self.last_right_icon if self.last_right_icon else "dots-vertical"
    custom_fn: self.custom_fn if self.custom_fn else None
    MDGridLayout:
        canvas.before:
            Color:
                rgba: app.theme_cls.primary_color
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint: 1, .1
        cols: 4
        MDFloatLayout:
            size_hint_x: None
            width: 70
            MDIconButton:
                theme_text_color: 'Custom'
                text_color: app.theme_cls.opposite_text_color
                icon: 'menu'
                pos_hint: {'center_y': .5, 'center_x': .4}
        MDFloatLayout:
            MDLabel:
                text: root.title
                markup: True
                shorten: True
                font_size: '19sp'
                color: 1, 1, 1, 1
                pos_hint: {'center_y': .5, 'center_x': .5}
        # Boton provisorio para cambiar de estilo de tema
        MDFloatLayout:
            size_hint_x: None
            width: 40
            MDIconButton:
                theme_text_color: 'Custom'
                text_color: 1, 1, 1, 1
                icon: 'palette'
                pos_hint: {'center_y': .5, 'center_x': .5}
                on_release:
                    app.change_theme_style()
#        MDFloatLayout:
#            size_hint_x: None
#            width: 40
#            MDIconButton:
#                theme_text_color: 'Custom'
#                text_color: 1, 1, 1, 1
#                icon: 'information'
#                pos_hint: {'center_y': .5, 'center_x': .5}
        MDFloatLayout:
            size_hint_x: None
            width: 40
            MDIconButton:
                theme_text_color: 'Custom'
                text_color: app.theme_cls.opposite_text_color
                icon: root.last_right_icon
                custom_fn: root.custom_fn
                pos_hint: {'center_y': .5, 'center_x': .5}
                on_release:
                    app.close_app() if self.icon == 'close' else self.custom_fn

# Ya no se usa porque el Login ya se hizo
<LoginBaseLayout@MDBoxLayout>:
    id: main_toolbar
    orientation: 'vertical'
    MDGridLayout:
        padding: 19, 0
        rows: 1
        size_hint_y: None
        height: 40
        MDFloatLayout:
            canvas.before:
                Color:
                    rgba: primary_color
                Rectangle:
                    pos: self.pos
                    size: self.size
            size_hint: 1, .1
            orientation: 'horizontal'
            MDIconButton:
                theme_text_color: 'Custom'
                text_color: 1, 1, 1, 1
                icon: 'information'
                pos_hint: {'center_y': .5, 'center_x': .97}


<CommonTextField@MDTextField>:
    size_hint: 0.75, 0.1
    size_hint_min_y: 55
    size_hint_max_y: 65
    multiline: False
    required: True
    max_text_length: 32
    helper_text: "Este campo es obligatorio"
    line_color_normal: app.theme_cls.primary_color
    color_mode: 'custom'
    line_color_focus: app.theme_cls.primary_color


<MultilineTextField@MDTextField>:
    multiline: True
    line_color_normal: app.theme_cls.primary_color
    color_mode: 'custom'
    line_color_focus: app.theme_cls.primary_color


<OnlyAlphaNumericTextField@CommonTextField>:
<ReplicableTextField@CommonTextField>:


<NumericField@CommonTextField>:
    size_hint: 0.75, 0.1
    input_filter: 'int'
    color_mode: 'custom'
    line_color_focus: app.theme_cls.primary_color


<LabelButton@MDTextButton>:
    color: app.theme_cls.primary_color


<PurpleCenteredLabel@MDLabel>
    color: app.theme_cls.primary_color
    halign: 'center'

<PurpleButton@MDRaisedButton>
    md_bg_color: app.theme_cls.primary_color
    text_color: app.theme_cls.text_color
    size_hint_x: .4
    size_hint_y: .08
    size_hint_min_y: 20
    size_hint_max_y: 33
    elevation: 10

<PurpleIconButton@MDIconButton>
    theme_text_color: 'Custom'
    text_color: app.theme_cls.primary_color
    user_font_size: "18sp"

<AnimatedProgressBar@MDProgressBar>:
    type: "indeterminate"
    running_duration: 1
    catching_duration: 1.5
    color: app.theme_cls.primary_color
    size_hint: 1, 1
    pos_hint:{'center_y': .5, 'center_x': 0.5}


<CircularButton>:
    canvas:
        Color:
            rgb: app.theme_cls.primary_color if self.active else inactive_color
        RoundedRectangle:
            size: (20, 20)
            pos: (self.pos)
            radius: [400, ]
    pos_hint:{'center_y': .5}
    size_hint_x: None

<PaddingLayout@MDGridLayout>:
    rows: 1
    padding: 19.5, 0


<DotLayout@MDGridLayout>:
    size_hint: None, None
    width: 20
    height: 20
    pos_hint:{'center_y': 0.5}
    cols: 2


<ProgressComponent>:
    size_hint: 1, .07
    steps: 5
    step: 0
    padding: 19.5, 0
    pos_hint:{'center_y': (4.9/root.steps)-0.1, 'center_x': 0.5}
    DotLayout:
        CircularButton:
            id: step_1
    MDGridLayout:
        rows: 1
        AnimatedProgressBar:
            id: step_2
    DotLayout:
        CircularButton:
            id: step_3
    MDGridLayout:
        rows: 1
        AnimatedProgressBar:
            id: step_4
    DotLayout:
        CircularButton:
            id: step_5


<ButtonIcon@ButtonBehavior+MDIcon>:


<CardItem@MDGridLayout>:
    rows: 1
    cols: 2
    size_hint: None, 1
    width: 150
    container_width: self.width
    label_text: self.label_text if self.label_text else '@entity #service'
    # col 1
    MDLabel:
        canvas.before:
            Color:
                rgba: app.theme_cls.bg_light
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint_x: None
        width: root.container_width*.67
        text: root.label_text
        halign: 'center'
    # col 2
    MDGridLayout:
        canvas.before:
            Color:
                rgba: app.theme_cls.bg_light
            Rectangle:
                pos: self.pos
                size: self.size
        rows: 2
        spacing: 0, 0
        size_hint_x: None
        width: root.container_width*.33
        MDGridLayout:
            size_hint_x: None
            width: root.container_width*.33
            cols: 1
            ButtonIcon:
                icon: 'pencil'
                theme_text_color: 'Custom'
                text_color: app.theme_cls.primary_color
                halign: 'center'
                valign: 'middle'
                on_release:
                    app.edit_area(root.id)
        MDGridLayout:
            size_hint_x: None
            width: root.container_width*.33
            rows: 1
            ButtonIcon:
                icon: 'trash-can'
                halign: 'center'
                valign: 'middle'
                on_release:
                    app.delete_area(root.id)


<ShareCard@MDGridLayout>:
    rows: 1
    cols: 2
    size_hint: None, 1
    width: 190
    container_width: self.width
    item_name: self.item_name if self.item_name else 'item_name'
    code: self.code if self.code else 'code'
    # col 1
    MDGridLayout:
        canvas.before:
            Color:
                rgba: app.theme_cls.bg_light
            Rectangle:
                pos: self.pos
                size: self.size
        id: 'layout_'+root.code
        rows: 2
        spacing: 0, 0
        size_hint_x: None
        width: root.container_width*.67
        on_touch_down:
            root.show_entity_areas(args[1], root.code)
        MDGridLayout:
            size_hint_x: None
            width: root.container_width*.67
            rows: 2
            PurpleCenteredLabel:
                size_hint_x: 1
                width: root.container_width*.33
                text: root.item_name
            PurpleCenteredLabel:
                size_hint_x: 1
                width: root.container_width*.33
                text: 'code: '+root.code
    # col 2
    ButtonIcon:
        canvas.before:
            Color:
                rgba: app.theme_cls.bg_light
            Rectangle:
                pos: self.pos
                size: self.size
        icon: 'share-variant'
        theme_text_color: 'Custom'
        text_color: app.theme_cls.primary_color
        halign: 'center'
        valign: 'middle'


<ChannelLayout@MDGridLayout>:
    canvas.before:
        Color:
            rgba: inactive_color
        Line:
            width: 2
            rectangle: self.x, self.y, self.width, self.height
        Color:
            rgba: app.theme_cls.primary_color if self.is_active else app.theme_cls.bg_light
        Rectangle:
            pos: self.pos
            size: self.size
    rows: 2
    padding: 5
    channel_name: self.channel_name if self.channel_name else "-"
    is_active: self.is_active if self.is_active else False
    icon: self.icon if self.icon else 'whatsapp'
    AnchorLayout:
        anchor_x:'center'
        anchor_y:'center'
        MDIconButton:
            icon: root.icon
            theme_text_color: 'Custom'
            text_color: app.theme_cls.bg_dark if root.is_active else app.theme_cls.bg_darkest
            # white_color if root.is_active else gray_white_color
    MDLabel:
        text: root.channel_name
        color: app.theme_cls.bg_dark if root.is_active else app.theme_cls.bg_darkest
        halign: "center"
        size_hint_y: None
        height: 30
        font_size: "12sp"
        markup: True
        shorten: True


<ChannelsGrid@MDGridLayout>:
    canvas.before:
        Color:
            rgba: app.theme_cls.bg_dark
        Line:
            width: 1
            rectangle: self.x, self.y, self.width, self.height
    widget_count: 4
    cols: 4
    size_hint_y: None
    height: 100
    ChannelLayout:
        channel_name: "Whatsapp"
        is_active: True
    ChannelLayout:
        icon: "instagram"
        channel_name: "Instagram"
    ChannelLayout:
        icon: "telegram"
        channel_name: "Telegram"
    ChannelLayout:
        icon: "facebook"
        channel_name: "Facebook"


<Filechooser>:
    canvas.before:
        Color:
            rgba: 0, 0, 1, 1
        Line:
            width: 3
            rectangle: self.x, self.y, self.width, self.height
    label: label
    cols: 1
    # Creating the File list / icon view
    MDGridLayout:
        # Creating list view one side
        cols: 2
        FileChooserListView:
            canvas.before:
                Color:
                    rgb: .4, .5, .5
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: 1, 0, 0, 1
                Line:
                    width: 3
                    rectangle: self.x, self.y, self.width, self.height
            on_selection: root.select(*args)
        # Creating Icon view other side
#        FileChooserIconView:
#            canvas.before:
#                Color:
#                    rgb: .5, .4, .5
#                Rectangle:
#                    pos: self.pos
#                    size: self.size
#            on_selection: root.select(*args)
    # Adding label
    Label:
        id: label
        size_hint_y: .1
        canvas.before:
            Color:
                rgb: .5, .5, .4
            Rectangle:
                pos: self.pos
                size: self.size