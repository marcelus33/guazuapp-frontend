ScreenManager:
    NewEntityWindow:
    AddAreaWindow:
    AddWhatsappWindow:
    ValidateWhatsappWindow:
    ShareCodeWindow:

#:set primary_color (94/255, 53/255, 177/255, 1)
#:set inactive_color (220/255, 220/255, 220/255, 1)


# BoxLayout con Toolbar que se usa de base en todas las pantallas
<BaseLayout@MDBoxLayout>:
    orientation: 'vertical'
    MDToolbar:
        title: "GuazuApp"
        pos_hint:{'center_x': 0.5, 'top': 1}
        md_bg_color: primary_color
        left_action_items: [["menu", lambda x: app.callback1_()]]
        right_action_items: [["information", lambda x: app.callback_2()], ["dots-vertical", lambda x: app.callback_3()]]


<CommonTextField@MDTextField>:
    size_hint: 0.75, 0.14
    multiline: False
    required: True
    max_text_length: 32
    helper_text: "This field is required"
    line_color_normal: primary_color


<LabelButton@ButtonBehavior+MDLabel>:
    color: primary_color
    halign: 'center'

<PurpleCenteredLabel@MDLabel>
    color: primary_color
    halign: 'center'

<PurpleButton@MDRaisedButton>
    md_bg_color: primary_color
    text_color: 1, 1, 1, 1

<AnimatedProgressBar@MDProgressBar>:
    color: primary_color
    type: "indeterminate"
    running_duration: 1
    catching_duration: 1.5


<CircularButton>:
    canvas:
        Color:
            rgb: primary_color if self.active else inactive_color
        RoundedRectangle:
            size: (20, 20)
            pos: (self.pos)
            radius: [400, ]
    pos_hint:{'center_y': (1)-0.14}
    size_hint_x: None
    width: 19.5

<ProgressComponent>:
    size_hint: .7, .15
    steps: 5
    step: 0
    pos_hint:{'center_y': (4.5/root.steps)-0.1, 'center_x': 0.5}
    # 'debug' border
#    canvas.before:
#        Color:
#            rgba: 1, 0, 0, 1
#        Line:
#            width: 2
#            rectangle: self.x, self.y, self.width, self.height
    CircularButton:
        id: step_1
    AnimatedProgressBar:
        id: step_2
    CircularButton:
        id: step_3
    AnimatedProgressBar:
        id: step_4
    CircularButton:
        id: step_5


<NewEntityWindow>:
    name: "new_entity"
    widget_count : 5
    BaseLayout:
        MDFloatLayout:
            PurpleCenteredLabel:
                text: "Create new entity"
                pos_hint:{'center_y': (5/root.widget_count)-0.1}
            ProgressComponent:
                step: 1
            CommonTextField:
                hint_text: "Name of your organization"
                helper_text_mode: "on_error"
                pos_hint:{'center_x': 0.5, 'center_y': (4/root.widget_count)-0.1}
            CommonTextField:
                icon_right: "at"
                hint_text: "Id name of the entity"
                helper_text_mode: "on_error"
                pos_hint:{'center_x': 0.5, 'center_y': (3/root.widget_count)-0.1}
            LabelButton:
                text: "More options"
                pos_hint:{'center_y': (2/root.widget_count)-0.1}
            PurpleButton:
                text: "Create entity"
                pos_hint:{'center_x': 0.5, 'center_y': (1/root.widget_count)-0.1}
                md_bg_color: primary_color
                text_color: 1, 1, 1, 1
                on_release:
                    app.root.current = "add_area"
                    root.manager.transition.direction = "left"


<AddAreaWindow>:
    name: "add_area"
    widget_count : 4
    BaseLayout:
        MDFloatLayout:
            PurpleCenteredLabel:
                text: "Add areas to entity"
                pos_hint:{'center_y': (4/root.widget_count)-0.1}
            ProgressComponent:
                step: 2
            CommonTextField:
                hint_text: "Name of the area"
                helper_text_mode: "on_error"
                pos_hint:{'center_x': 0.5, 'center_y': (3/root.widget_count)-0.1}
            PurpleButton:
                text: "Add"
                pos_hint:{'center_x': 0.5, 'center_y': (2/root.widget_count)-0.1}
                md_bg_color: primary_color
                text_color: 1, 1, 1, 1
                on_release:
                    app.root.current = "add_whatsapp"
                    root.manager.transition.direction = "left"
            # TODO agregar SCROLLVIEW
            LabelButton:
                text: "Done"
                pos_hint:{'center_y': (1/root.widget_count)-0.1}
                on_release:
                    app.root.current = "add_whatsapp"
                    root.manager.transition.direction = "left"


<AddWhatsappWindow>:
    name: "add_whatsapp"
    widget_count : 4
    BaseLayout:
        MDFloatLayout:
            PurpleCenteredLabel:
                text: "Add Whatsapp number"
                pos_hint:{'center_y': (4/root.widget_count)-0.1}
            ProgressComponent:
                step: 3
            CommonTextField:
                hint_text: "Name of the area"
                helper_text_mode: "on_error"
                pos_hint:{'center_x': 0.5, 'center_y': (3/root.widget_count)-0.1}
            PurpleButton:
                text: "Add"
                pos_hint:{'center_x': 0.5, 'center_y': (2/root.widget_count)-0.1}
                md_bg_color: primary_color
                text_color: 1, 1, 1, 1
                on_release:
                    app.root.current = "add_whatsapp"
                    root.manager.transition.direction = "left"
            # TODO agregar SCROLLVIEW
            LabelButton:
                text: "Next"
                pos_hint:{'center_y': (1/root.widget_count)-0.1}
                on_release:
                    app.root.current = "validate_whatsapp"
                    root.manager.transition.direction = "left"


<ValidateWhatsappWindow>:
    name: "validate_whatsapp"
    widget_count : 5
    BaseLayout:
        MDFloatLayout:
            PurpleCenteredLabel:
                text: "Validate Whatsapp number"
                pos_hint:{'center_y': (5/root.widget_count)-0.1}
            ProgressComponent:
                step: 4
            PurpleCenteredLabel:
                text: "Scan the code from your organization's phone with the Whatsapp App"
                pos_hint:{'center_y': (4/root.widget_count)-0.1}
            Image:
                source: 'images/qrcode.png'
                pos_hint:{'center_y': (3/root.widget_count)-0.1, 'center_x': .5}
                size_hint: 0.4, 0.4
            MDIconButton:
                canvas.before:
                    PushMatrix
                    Rotate:
                        angle: 270
                        origin: self.center
                canvas.after:
                    PopMatrix
                icon: "refresh-circle"
                user_font_size: "48sp"
                pos_hint:{'center_x': 0.5, 'center_y': (2/root.widget_count)-0.1}
#                md_bg_color: primary_color  # 94/255, 53/255, 177/255, 1
#                on_release:
#                    app.root.current = "add_whatsapp"
#                    root.manager.transition.direction = "left"
            # TODO agregar SCROLLVIEW
            LabelButton:
                text: "Done"
                pos_hint:{'center_y': (1/root.widget_count)-0.1}
                on_release:
                    app.root.current = "share_code"
                    root.manager.transition.direction = "left"


<ShareCodeWindow>:
    name: "share_code"
    widget_count : 4
    BaseLayout:
        MDFloatLayout:
            PurpleCenteredLabel:
                text: "Share your codes of subscriptions"
                pos_hint:{'center_y': (4/root.widget_count)-0.1}
            ProgressComponent:
                step: 5
            # TODO agregar texto Scan the code from your organization's phone with the Whatsapp App
            MDIconButton:
                icon: "refresh-circle"
                user_font_size: "48sp"
                pos_hint:{'center_x': 0.5, 'center_y': (2/root.widget_count)-0.1}
                theme_text_color: 'Primary'  # 94/255, 53/255, 177/255, 1
#                on_release:
#                    app.root.current = "add_whatsapp"
#                    root.manager.transition.direction = "left"
            # TODO agregar SCROLLVIEW
            LabelButton:
                text: "Done"
                pos_hint:{'center_y': (1/root.widget_count)-0.1}
                on_release:
                    app.root.current = "new_entity"
                    root.manager.transition.direction = "left"
